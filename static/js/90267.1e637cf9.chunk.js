"use strict";(self.webpackChunkimage_editor=self.webpackChunkimage_editor||[]).push([[90267],{90267:(n,i,e)=>{e.d(i,{autoConnectWC:()=>I,connectWC:()=>y});var a=e(4484),t=e(66106),o=e(54235),s=e(40886),c=e(64733),l=e(16940),r=e(48959),d=e(22319),u=e(69737),h=e(11302),p=e(13717),v=e(92092);const m="08c4b07e3ad25f1a27c14a4e8cecb6f0",w="eip155",g="wallet_addEthereumChain",C=!0,f={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function y(n,i,e,a,t){var s;const l=await T(n,e,t),r=n.walletConnect;let{onDisplayUri:u}=r||{};if(!u&&t){const n=await(0,c.u)(e);u=i=>{const e=n.mobile.native||n.mobile.universal;if(!e)throw new Error("No app url found for wallet connect to redirect to.");const a=(0,v.Y)(e,i).redirect;t(a)}}u&&l.events.addListener("display_uri",u);const{rpcMap:h,chainsToRequest:m}=b({client:n.client,chain:n.chain,optionalChains:null===(s=n.walletConnect)||void 0===s?void 0:s.optionalChains});l.session&&await l.connect({...null!==r&&void 0!==r&&r.pairingTopic?{pairingTopic:null===r||void 0===r?void 0:r.pairingTopic}:{},optionalChains:m,chains:n.chain?[n.chain.id]:m.length>0?[m[0]]:[1],rpcMap:h}),q(m,a);const w=(await l.enable())[0];if(!w)throw new Error("No accounts found on provider.");const g=(0,d.A)(l.chainId),C=n.chain&&n.chain.id===g?n.chain:(0,o.Q4)(g);if(n){var f,y;const i={optionalChains:null===(f=n.walletConnect)||void 0===f?void 0:f.optionalChains,chain:n.chain,pairingTopic:null===(y=n.walletConnect)||void 0===y?void 0:y.pairingTopic};a&&(0,p.O7)(a,e,i)}return null!==r&&void 0!==r&&r.onDisplayUri&&l.events.removeListener("display_uri",r.onDisplayUri),_(w,C,l,i,a)}async function I(n,i,e,a,t){const s=a?await(0,p.lh)(a,e):null,c=await T(s?{chain:s.chain,client:n.client,walletConnect:{pairingTopic:s.pairingTopic,optionalChains:s.optionalChains}}:{client:n.client,walletConnect:{}},e,t,!0),l=c.accounts[0];if(!l)throw new Error("No accounts found on provider.");const r=(0,d.A)(c.chainId);return _(l,n.chain&&n.chain.id===r?n.chain:(0,o.Q4)(r),c,i,a)}async function T(n,i,a){var t,o,s,l,d;let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=await(0,c.u)(i),p=n.walletConnect,{EthereumProvider:v,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:g}=await Promise.all([e.e(49055),e.e(99432)]).then(e.bind(e,49055)),{rpcMap:f,chainsToRequest:y}=b({client:n.client,chain:n.chain,optionalChains:null===(t=n.walletConnect)||void 0===t?void 0:t.optionalChains}),I=await v.init({showQrModal:!a&&(void 0===(null===p||void 0===p?void 0:p.showQrModal)?C:p.showQrModal),projectId:(null===p||void 0===p?void 0:p.projectId)||m,optionalMethods:g,optionalEvents:w,optionalChains:y,chains:n.chain?[n.chain.id]:y.length>0?[y[0]]:[1],metadata:{name:(null===p||void 0===p||null===(o=p.appMetadata)||void 0===o?void 0:o.name)||(0,r.o)().name,description:(null===p||void 0===p||null===(s=p.appMetadata)||void 0===s?void 0:s.description)||(0,r.o)().description,url:(null===p||void 0===p||null===(l=p.appMetadata)||void 0===l?void 0:l.url)||(0,r.o)().url,icons:[(null===p||void 0===p||null===(d=p.appMetadata)||void 0===d?void 0:d.logoUrl)||(0,r.o)().logoUrl]},rpcMap:f,qrModalOptions:null===p||void 0===p?void 0:p.qrModalOptions,disableProviderPing:!0});if(I.events.setMaxListeners(Number.POSITIVE_INFINITY),u||I.session&&await I.disconnect(),"walletConnect"!==i){function T(){var n;const i=(null===(n=I.session)||void 0===n||null===(n=n.peer)||void 0===n||null===(n=n.metadata)||void 0===n||null===(n=n.redirect)||void 0===n?void 0:n.native)||h.mobile.native||h.mobile.universal;a&&i&&a(i)}I.signer.client.on("session_request_sent",T),I.events.addListener("disconnect",(()=>{I.signer.client.off("session_request_sent",T)}))}return I}function M(n,i){return{address:i,async sendTransaction(i){return{transactionHash:await n.request({method:"eth_sendTransaction",params:[{gas:i.gas?(0,s.cK)(i.gas):void 0,value:i.value?(0,s.cK)(i.value):void 0,from:this.address,to:i.to,data:i.data}]})}},async signMessage(i){let{message:e}=i;const a="string"===typeof e?(0,s.i3)(e):e.raw instanceof Uint8Array?(0,s.EY)(e.raw):e.raw;return n.request({method:"personal_sign",params:[a,this.address]})},async signTypedData(i){const e=(0,h.y)(i),{domain:t,message:o,primaryType:s}=e,c={EIP712Domain:(0,a.H4)({domain:t}),...e.types};(0,a.$$)({domain:t,message:o,primaryType:s,types:c});const l=(0,a.v8)({domain:null!==t&&void 0!==t?t:{},message:o,primaryType:s,types:c});return await n.request({method:"eth_signTypedData_v4",params:[this.address,l]})}}}function _(n,i,e,a,c){const r=M(e,n);async function h(){e.removeListener("accountsChanged",v),e.removeListener("chainChanged",m),e.removeListener("disconnect",p),await e.disconnect()}function p(){q([],c),null===c||void 0===c||c.removeItem(f.lastUsedChainId),h(),a.emit("disconnect",void 0)}function v(n){if(n[0]){const i=M(e,(0,u.bv)(n[0]));a.emit("accountChanged",i),a.emit("accountsChanged",n)}else p()}function m(n){const i=(0,o.Q4)((0,d.A)(n));a.emit("chainChanged",i),null===c||void 0===c||c.setItem(f.lastUsedChainId,String(n))}return e.on("accountsChanged",v),e.on("chainChanged",m),e.on("disconnect",p),e.on("session_delete",p),[r,i,h,n=>async function(n,i,e){const a=i.id;try{const t=function(n){var i;const e=null===(i=n.session)||void 0===i||null===(i=i.namespaces[w])||void 0===i||null===(i=i.chains)||void 0===i?void 0:i.map((n=>Number.parseInt(n.split(":")[1]||"")));return null!==e&&void 0!==e?e:[]}(n),d=function(n){var i;return(null===(i=n.session)||void 0===i||null===(i=i.namespaces[w])||void 0===i?void 0:i.methods)||[]}(n);if(!t.includes(a)&&d.includes(g)){var c,r;const t=await(0,o.PB)(i);await n.request({method:g,params:[{chainId:(0,s.cK)(t.chainId),chainName:t.name,nativeCurrency:t.nativeCurrency,rpcUrls:(0,l.k)(t),blockExplorerUrls:(null===(c=i.blockExplorers)||void 0===c?void 0:c.slice(0,1))||(null===(r=t.explorers)||void 0===r?void 0:r.slice(0,1))||[]}]});const d=await async function(n){const i=await n.getItem(f.requestedChains);return i?JSON.parse(i):[]}(e);d.push(a),q(d,e)}await n.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,s.cK)(a)}]})}catch(d){const n="string"===typeof d?d:null===d||void 0===d?void 0:d.message;if(/user rejected request/i.test(n))throw new t.vx(d);throw new t.ch(d)}}(e,n,c)]}function q(n,i){null===i||void 0===i||i.setItem(f.requestedChains,JSON.stringify(n))}function b(n){const i={};n.chain&&(i[n.chain.id]=(0,o.r8)({chain:n.chain,client:n.client}));const e=((null===n||void 0===n?void 0:n.optionalChains)||[]).slice(0,10);for(const s of e)i[s.id]=(0,o.r8)({chain:s,client:n.client});const a=e.map((n=>n.id))||[],t=n.chain?[n.chain.id,...a]:a.length>0?a:[1];return n.chain||0!==e.length||(i[1]=(0,o.Q4)(1).rpc),{rpcMap:i,chainsToRequest:t}}}}]);
//# sourceMappingURL=90267.1e637cf9.chunk.js.map